
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modern Chat App</title>
<link href="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1.5.2/dist/emoji-picker-element.min.js" rel="stylesheet">
<style>
  body { margin:0; font-family: Arial, sans-serif; background:#f0f2f5; display:flex; height:100vh; }
  #sidebar { width:200px; background:#fff; border-right:1px solid #ddd; display:flex; flex-direction:column; padding:10px; }
  #sidebar h2 { margin:0 0 10px 0; font-size:18px; }
  #users { flex:1; overflow-y:auto; }
  #chat-container { flex:1; display:flex; flex-direction:column; }
  #chat { flex:1; padding:10px; overflow-y:auto; }
  .message { margin:5px 0; padding:8px 12px; border-radius:15px; max-width:70%; }
  .self { background:#4CAF50; color:#fff; align-self:flex-end; }
  .other { background:#e4e6eb; align-self:flex-start; }
  .system { background:#ffd700; color:#000; text-align:center; border-radius:10px; max-width:100%; margin:5px auto; }
  #typing { font-style:italic; color:#666; margin-bottom:5px; }
  #input-bar { display:flex; padding:10px; border-top:1px solid #ddd; background:#fff; }
  #message { flex:1; padding:8px; border-radius:20px; border:1px solid #ccc; }
  #send { margin-left:5px; padding:8px 15px; border:none; background:#4CAF50; color:#fff; border-radius:20px; cursor:pointer; }
  #send:hover { background:#45a049; }
  emoji-picker { position: absolute; bottom:60px; }
</style>
</head>
<body>
<div id="sidebar">
  <h2>Users Online</h2>
  <div id="users"></div>
</div>
<div id="chat-container">
  <div id="chat"></div>
  <div id="typing"></div>
  <div id="input-bar">
    <input id="message" autocomplete="off" placeholder="Type your message..." />
    <button id="emoji-btn">ðŸ˜Š</button>
    <button id="send">Send</button>
    <emoji-picker style="display:none;"></emoji-picker>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script type="module">
  const socket = io();
  const chat = document.getElementById('chat');
  const usersDiv = document.getElementById('users');
  const typingDiv = document.getElementById('typing');
  const messageInput = document.getElementById('message');
  const sendBtn = document.getElementById('send');
  const emojiBtn = document.getElementById('emoji-btn');
  const emojiPicker = document.querySelector('emoji-picker');

  let nickname = prompt('Enter your nickname') || 'Anonymous';
  socket.emit('set nickname', nickname);

  socket.on('chat message', data => {
    const div = document.createElement('div');
    if(data.system){
      div.className = 'message system';
      div.textContent = data.msg;
    } else {
      div.className = 'message ' + (data.user===nickname ? 'self' : 'other');
      div.textContent = `[${data.time}] ${data.user}: ${data.msg}`;
    }
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  });

  socket.on('update users', list => {
    usersDiv.innerHTML = '';
    list.forEach(u => { const d=document.createElement('div'); d.textContent=u; usersDiv.appendChild(d); });
  });

  sendBtn.addEventListener('click', () => {
    if(messageInput.value){ socket.emit('chat message', messageInput.value); messageInput.value=''; socket.emit('typing', false); }
  });

  messageInput.addEventListener('input', () => { socket.emit('typing', messageInput.value.length>0); });
  messageInput.addEventListener('keypress', e => { if(e.key==='Enter'){ e.preventDefault(); sendBtn.click(); } });

  socket.on('typing', data => { typingDiv.textContent = data.status ? `${data.user} is typing...` : ''; });

  emojiBtn.addEventListener('click', () => { emojiPicker.style.display = emojiPicker.style.display==='none'?'block':'none'; });
  emojiPicker.addEventListener('emoji-click', e => { messageInput.value += e.detail.unicode; emojiPicker.style.display='none'; messageInput.focus(); });
</script>
</body>
</html>
